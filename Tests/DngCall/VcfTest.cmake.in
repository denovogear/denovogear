###############################################################################
# Test if dng-call crashes on partial pedigrees

set(PartialPed-CMD @DNG_CALL_EXE@ --ped ped/duo.ped bcftools/trio.call.vcf)
set(PartialPed-WD "@TESTDATA_DIR@/human_trio/")
set(PartialPed-RESULT 0)
set(PartialPed-STDOUT
  "##PEDIGREE=<ID=LB/NA12878,Original=GL/1,OriginalMR=0.0>"
)

set(PartialPed2-CMD @DNG_CALL_EXE@ -m 0 --ped ped/trio.ped vcf/duo.vcf)
set(PartialPed2-WD "@TESTDATA_DIR@/human_trio/")
set(PartialPed2-RESULT 0)
set(PartialPed2-STDOUT
  "##PEDIGREE=<ID=LB/NA12878,Father=GL/NA12891,Mother=GL/NA12892,FatherMR=10.0e-09,MotherMR=10.0e-09>"
  "##PEDIGREE=<ID=LB/NA12892,Original=GL/NA12892,OriginalMR=0.0>"
)
set(PartialPed2-STDOUT-FAIL
  "##PEDIGREE=<ID=LB/NA12891,Original=GL/NA12891,OriginalMR=0.0>"
)

###############################################################################
# Test if dng-call crashes on empty pedigrees

set(EmptyPed-CMD @DNG_CALL_EXE@ --ped empty.ped trio.vcf)
set(EmptyPed-WD "@TESTDATA_DIR@/human_trio/")
set(EmptyPed-RESULT 0)

###############################################################################
# Test if dng-call works on a trio

set(TrioMpileup-CMD @DNG_CALL_EXE@ -p ped/trio.ped bcftools/trio.mpileup.vcf)
set(TrioMpileup-WD "@TESTDATA_DIR@/human_trio")
set(TrioMpileup-RESULT 0)
set(TrioMpileup-STDOUT
  "\r?\n5\t126385924\t\\.\tG\tT,<\\*>\t"
  "\r?\n5\t126385924\t.*\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t"
  "\r?\n5\t126385924\t.*\tMUP=0\\.999969\;"
  "\r?\n5\t126385924\t.*\;LLD=-22\\.653\;"
  "\r?\n5\t126385924\t.*\;LLS=0\\.90977\;"
  "\r?\n5\t126385924\t.*\;MUX=0\\.999969\;"
  "\r?\n5\t126385924\t.*\;MU1P=0\\.999969\;"
  "\r?\n5\t126385924\t.*\;DNT=G/GxG/G->G/T\;"
  "\r?\n5\t126385924\t.*\;DNL=LB/NA12878\;"
  "\r?\n5\t126385924\t.*\;DNQ=127\;"
  "\r?\n5\t126385924\t.*\;DP=113\;"
  "\r?\n5\t126385924\t.*\;AD=92,21,0\t"
  "\r?\n5\t126385924\t.*\t0/0:46:0\\.999973,2\\.70019e-05,0,6\\.68272e-17,0,0:0:0:\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.\t"
  "\r?\n5\t126385924\t.*\t0/0:54:0\\.999996,3\\.85718e-06,0,2\\.89294e-14,0,0:0:0:\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.\t"
  "\r?\n5\t126385924\t.*\t0/0:54:0\\.999996,3\\.85718e-06,0,2\\.89294e-14,0,0:0:0:0,-10\\.1127,-75\\.3322,-10\\.1127,-75\\.3322,-75\\.3322:34:34,0,0\t"
  "\r?\n5\t126385924\t.*\t0/1:255:6\\.2615e-31,1,8\\.45815e-38,1\\.00893e-43,1\\.77965e-43,0:1:1:-38\\.5043,0,-28\\.1696,-42\\.9961,-34\\.1479,-77\\.144:35:15,20,0\t"
  "\r?\n5\t126385924\t.*\t0/0:46:0\\.999973,2\\.70019e-05,0,6\\.68272e-17,0,0:0:0:0,-9\\.26756,-87\\.0858,-12\\.7491,-87\\.3868,-90\\.8683:44:43,1,0\r?\n"
)

###############################################################################
# Test if dng-call supports regions

set(TrioRegion-CMD @DNG_CALL_EXE@ -p ped/trio.ped -m 0 -r 5:126385921-126385925 bcftools/trio.mpileup.vcf.gz)
set(TrioRegion-WD "@TESTDATA_DIR@/human_trio")
set(TrioRegion-RESULT 0)
set(TrioRegion-STDOUT
  "\r?\n5\t126385921\t"
  "\r?\n5\t126385922\t"
  "\r?\n5\t126385923\t"
  "\r?\n5\t126385924\t"
  "\r?\n5\t126385925\t"
)
set(TrioRegion-STDOUT-FAIL
  "\r?\n5\t12638592[^1-5]\t"
  "\r?\n5\t1263859[0,1,3-9][0-9]\t"
)

###############################################################################
# Test if dng-call ignores samples

set(TrioExtraSample-CMD @DNG_CALL_EXE@ -p ped/trio.ped vcf/extra_sample.vcf)
set(TrioExtraSample-WD "@TESTDATA_DIR@/human_trio")
set(TrioExtraSample-RESULT 0)
set(TrioExtraSample-STDOUT
  "\tFORMAT\tGL/NA12892\tGL/NA12891\tLB/NA12891\tLB/NA12878\tLB/NA12892\r?\n"
)
set(TrioExtraSample-FAIL
  "\tLB/FAKE(\t|\r?\n)"
)

###############################################################################
# Test how dng-call handles missing data

set(MissingData-CMD @DNG_CALL_EXE@ -m 0 --ped trio.ped trio_missing.vcf)
set(MissingData-WD "@TESTDATA_DIR@/vcf_missing_data/")
set(MissingData-RESULT 0)
set(MissingData-STDOUT
"1\t1\t\\.\tA\t\\.\t\\.\t\\.\tMUP=-0\;LLD=-0\\.000911533\;LLS=-0\\.000911533\;MUX=0\;MU1P=0\;DP=0\;AD=0\tGT:GQ:GP:MUP:GL:DP:AD\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0"
"1\t2\t\\.\tA\t\\.\t\\.\t\\.\tMUP=-0\;LLD=-0\\.000911533\;LLS=-0\\.000911533\;MUX=0\;MU1P=0\;DP=0\;AD=0\tGT:GQ:GP:MUP:GL:DP:AD\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0"
"1\t3\t\\.\tA\t\\.\t\\.\t\\.\tMUP=-0\;LLD=-0\\.000911533\;LLS=-0\\.000911533\;MUX=0\;MU1P=0\;DP=0\;AD=0\tGT:GQ:GP:MUP:GL:DP:AD\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0"
"1\t4\t\\.\tA\t\\.\t\\.\t\\.\tMUP=-0\;LLD=-0\\.000911533\;LLS=-0\\.000911533\;MUX=0\;MU1P=0\;DP=0\;AD=0\tGT:GQ:GP:MUP:GL:DP:AD\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:0:\\.:\\.:\\.\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0\t0/0:255:1:-?nan:0:0:0"

"1\t10\t\\.\tA\tC\t\\.\t\\.\tMUP=5\\.40595e-09\;LLD=-0\\.000651041\;LLS=-0\\.000651041\;MUX=5\\.40595e-09\;MU1P=5\\.40595e-09\;DNT=AAxAA>AC\;DNL=LB/NA12878\;DNQ=32\;DP=0\;AD=0,0\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:34:0\\.9996,0\\.000399726,3\\.99611e-08:1:1:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0"
"1\t11\t\\.\tA\tC\t\\.\t\\.\tMUP=5\\.40595e-09\;LLD=-0\\.000651041\;LLS=-0\\.000651041\;MUX=5\\.40595e-09\;MU1P=5\\.40595e-09\;DNT=AAxAA>AC\;DNL=LB/NA12878\;DNQ=32\;DP=0\;AD=0,0\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:34:0\\.9996,0\\.000399726,3\\.99611e-08:1:1:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0"
"1\t12\t\\.\tA\tC\t\\.\t\\.\tMUP=5\\.40595e-09\;LLD=-0\\.000651041\;LLS=-0\\.000651041\;MUX=5\\.40595e-09\;MU1P=5\\.40595e-09\;DNT=AAxAA>AC\;DNL=LB/NA12878\;DNQ=32\;DP=0\;AD=0,0\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:34:0\\.9996,0\\.000399726,3\\.99611e-08:1:1:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0"
"1\t13\t\\.\tA\tC\t\\.\t\\.\tMUP=5\\.40595e-09\;LLD=-0\\.000651041\;LLS=-0\\.000651041\;MUX=5\\.40595e-09\;MU1P=5\\.40595e-09\;DNT=AAxAA>AC\;DNL=LB/NA12878\;DNQ=32\;DP=0\;AD=0,0\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:\\.,\\.,\\.:\\.:\\.,\\.\t0/0:34:0\\.9996,0\\.000399726,3\\.99611e-08:1:1:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0\t0/0:35:0\\.9997,0\\.00019991,9\\.9945e-05:0:0:0,0,0:0:0,0"

"1\t20\t\\.\tA\tC,G,T\t\\.\t\\.\tMUP=1\\.892e-08\;LLD=.*\;LLS=.*\;MUX=1\\.892e-08\;MU1P=1\\.892e-08\;DNT=AAxAA>AT\;DNL=LB/NA12878\;DNQ=2\;DP=0\;AD=0,0,0,0\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.,\\.\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.,\\.\t0/0:29:0\\.998602,0\\.000399326,3\\.99212e-08,0\\.000399326,7\\.98424e-08,3\\.99212e-08,0\\.00059899,1\\.19764e-07,1\\.19764e-07,8\\.98227e-08:1:1:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0"
"1\t21\t\\.\tA\tC,G,T\t\\.\t\\.\tMUP=1\\.892e-08\;LLD=.*\;LLS=.*\;MUX=1\\.892e-08\;MU1P=1\\.892e-08\;DNT=AAxAA>AT\;DNL=LB/NA12878\;DNQ=2\;DP=0\;AD=0,0,0,0\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.,\\.\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.,\\.\t0/0:29:0\\.998602,0\\.000399326,3\\.99212e-08,0\\.000399326,7\\.98424e-08,3\\.99212e-08,0\\.00059899,1\\.19764e-07,1\\.19764e-07,8\\.98227e-08:1:1:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0"
"1\t22\t\\.\tA\tC,G,T\t\\.\t\\.\tMUP=1\\.892e-08\;LLD=.*\;LLS=.*\;MUX=1\\.892e-08\;MU1P=1\\.892e-08\;DNT=AAxAA>AT\;DNL=LB/NA12878\;DNQ=2\;DP=0\;AD=0,0,0,0\tGT:GQ:GP:MUP:MU1P:GL:DP:AD\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.,\\.\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.,\\.:\\.:\\.,\\.,\\.,\\.\t0/0:29:0\\.998602,0\\.000399326,3\\.99212e-08,0\\.000399326,7\\.98424e-08,3\\.99212e-08,0\\.00059899,1\\.19764e-07,1\\.19764e-07,8\\.98227e-08:1:1:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0\t0/0:30:0\\.998951,0\\.00019976,9\\.98701e-05,0\\.00019976,3\\.99401e-08,9\\.98701e-05,0\\.00029964,5\\.99101e-08,5\\.99101e-08,0\\.00014982:0:0:0,0,0,0,0,0,0,0,0,0:0:0,0,0,0"
)

###############################################################################
# Add Tests

include("@CMAKE_CURRENT_SOURCE_DIR@/CheckProcessTest.cmake")

CheckProcessTests(DngCall.Vcf
  PartialPed
  PartialPed2
  EmptyPed
  TrioMpileup
  TrioRegion
  TrioExtraSample
  MissingData
)
